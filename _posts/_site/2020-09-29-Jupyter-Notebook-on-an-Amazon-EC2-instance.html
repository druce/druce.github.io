<p>This is a tutorial on running Jupyter Notebook on an Amazon EC2 instance. It is based on a <a href="https://chrisalbon.com/software_engineering/cloud_computing/run_project_jupyter_on_amazon_ec2/">tutorial</a> by Chris Albon, which did not work for me immediately (itself based on a <a href="http://blog.impiyush.me/2015/02/running-ipython-notebook-server-on-aws.html">tutorial by Piyush Agarwal</a>). So I tweaked a few things and got it working.</p>

<h1 id="use-cases-for-aws-who-doesnt-love-aws">Use cases for AWS (Who doesn’t love AWS?)</h1>

<ul>
  <li>Scale up - get a giant instance that runs an algo on big data faster than your PC.</li>
  <li>Scale out - run many notebooks at once.</li>
  <li>Access resources you can’t, or don’t want to install on local PC: GPU, Postgres, etc.</li>
  <li>Everybody in industry uses it.</li>
</ul>

<h1 id="0-prerequisites-set-up-your-aws-account---i-wont-go-over-that-in-detail-see-here-however-2-recommendations">0) Prerequisites: Set up your AWS account - I won’t go over that in detail, <a href="https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/">see here</a>. However, 2 recommendations:</h1>

<ul>
  <li>Set up <a href="https://aws.amazon.com/iam/details/mfa/">2-factor authentication</a>. Who hasn’t had a password compromised? With 2FA, if your AWS password gets compromised, you don’t lose everything in your account. And you don’t have someone run up a huge AWS bill mining Bitcoin, or spamming the world.
    <ul>
      <li>I use the <a href="https://itunes.apple.com/us/app/google-authenticator/id388497605?mt=8">Google Authenticator</a> smartphone app</li>
      <li>Or, use a hardware key like <a href="http://www.1strategy.com/blog/2018/05/08/lock-down-your-aws-account-with-yubikey/">Yubikey</a> which is even more secure, doesn’t depend on having your phone, Internet access. (<a href="https://www.csoonline.com/article/3272425/authentication/11-ways-to-hack-2fa.html">People have hacked code-based 2FA</a> by compromising your phone, or getting people to enter their code on the Web)</li>
    </ul>
  </li>
  <li>Also, set up <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/monitor_estimated_charges_with_cloudwatch.html">billing alerts</a> so you get notified when your monthly bill exceeds e.g. $50.</li>
</ul>

<h1 id="1-create-an-instance">1) Create an instance</h1>

<ul>
  <li>
    <p>Log into the <a href="https://console.aws.amazon.com/">AWS console</a></p>

    <p><img src="00.1. Login.png" alt="00.1. Login.png" /></p>
  </li>
  <li>
    <p>Click on “EC2”</p>

    <p><img src="00.2. EC2.png" alt="00.2. EC2.png" /></p>
  </li>
  <li>
    <p>Click on “Launch instance”</p>

    <p><img src="01. Launch instance.png" alt="01. Launch instance.png" /></p>
  </li>
  <li>
    <p>Choose an Amazon Machine Image (AMI) - Ubuntu 18.04 LTS.</p>

    <p><img src="02. Choose image.png" alt="02. Choose image.png" /></p>

    <ul>
      <li>In general, choose latest Ubuntu LTS (Long Term Support), HVM virtualization, SSD storage. (Exception: when the latest Ubuntu is very new, give it ~6 months to mature, ensure all software, especially drivers are available and tested, e.g. GPU)</li>
    </ul>
  </li>
  <li>
    <p>Choose an instance type. For this demo choose the free tier eligible micro instance. Click “Next: Configure Instance Details”:</p>

    <p><img src="03. Choose instance type.png" alt="03. Choose instance type.png" /></p>
  </li>
  <li>
    <p>Choose “Next: Add Storage” (Shouldn’t have to modify anything on this page)</p>

    <p><img src="03.1. Instance details.png" alt="03.1. Instance details.png" /></p>
  </li>
  <li>
    <p>Set a reasonable disk size for storage, like 30GB (more if you have a big dataset). Click “Next: Add Tags”</p>

    <p><img src="04. Add storage.png" alt="04. Add storage.png" /></p>
  </li>
  <li>
    <p>Click “Next: Configure Security Group” (You don’t need to modify anything on this page. Tags help you keep track of servers and other resources, when you have a lot of them)</p>

    <p><img src="05. Add tags.png" alt="05. Add tags.png" /></p>

    <ul>
      <li>
        <p>Create a new security group like ‘Jupyter’.</p>

        <p><img src="06. Security group.png" alt="06. Security group.png" /></p>
      </li>
      <li>Click “Add rule”</li>
      <li>Set Type: All TCP</li>
      <li>Set Source: My IP</li>
      <li>Click the x at far right to delete the first rule</li>
      <li>What this means: Allow all access from my IP, no access from anywhere else (default was SSH from anywhere)</li>
      <li>Click “Review and Launch”</li>
      <li>
        <p>Click “Launch”</p>

        <p><img src="07.1 Review.png" alt="07.1 Review.png" /></p>
      </li>
    </ul>
  </li>
  <li>Almost there!</li>
  <li>
    <p>Choose “Create key pair”</p>

    <p><img src="07.2. keypair.png" alt="07.2. keypair.png" /></p>
  </li>
  <li>Give it a name like “mykey” or “AWS”</li>
  <li>Click “Download key pair”</li>
  <li>Click “Launch instance”</li>
  <li>You have launched your first AWS instance!</li>
</ul>

<h1 id="2-connect-to-your-instance-with-ssh">2) Connect to your instance with SSH</h1>

<ul>
  <li>
    <p>Remember that “AWS.pem” file you downloaded? Find it and move it to your home directory (or any directory).</p>
  </li>
  <li>
    <p>Open a terminal window or command prompt on your local PC.</p>
  </li>
  <li>
    <p>cd to your home directory.</p>
  </li>
  <li>
    <p>Move the downloaded key there.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MacBook-Pro-8:~ druce<span class="nv">$ </span><span class="nb">mv</span> ~/Downloads/AWS.pem <span class="nb">.</span>
</code></pre></div></div>

<ul>
  <li>Change its permissions so no one else can access it (ssh gives an error if it thinks permissions are wrong)</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MacBook-Pro-8:~ druce<span class="nv">$ </span><span class="nb">chmod </span>600 AWS.pem
</code></pre></div></div>

<ul>
  <li>
    <p>By now your instance should have launched. To find the IP address to connect to, go back to your <a href="https://console.aws.amazon.com/ec2/v2/#Instances">AWS console</a></p>

    <p><img src="09. AWSconsole1.png" alt="09. AWSconsole1.png" /></p>
  </li>
  <li>
    <p>Click on the instance - hover over “IPv4 Public IP” and click on the little copy icon that appears (can also use your ‘Public DNS’ everywhere I use IP in this post, doesn’t really matter. But don’t use ‘Private IP’ or ‘Private DNS’. Confusing, I know!)</p>

    <p><img src="10. AWSconsole2.png" alt="10. AWSconsole2.png" /></p>
  </li>
  <li>
    <p>Go back to your terminal and run this ssh command (paste your own IP or hostname)</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MacBook-Pro-8:~ druce<span class="nv">$ </span>ssh <span class="nt">-i</span> AWS.pem ubuntu@18.234.158.61
</code></pre></div></div>

<ul>
  <li>
    <p>Answer ‘yes’ to any prompt. If you see the Ubuntu bash command prompt, you are in business!</p>

    <p><img src="10.2 terminal.png" alt="10.2 terminal.png" /></p>
  </li>
</ul>

<p>Now we have successfully connected to our running AWS instance!</p>

<h1 id="3-run-installations-and-updates">3) Run installations and updates</h1>

<ul>
  <li>Get Ubuntu updates</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ubuntu@ip-172-30-3-209:~ <span class="nb">sudo </span>apt update
ubuntu@ip-172-30-3-209:~ <span class="nb">sudo </span>apt upgrade
</code></pre></div></div>
<p>If prompted about config files like grub, choose ‘keep local version’, tab to OK, hit enter.
  Updates will run for a couple of minutes.
  If you run ‘sudo apt upgrade’ again you will see this, showing your instance is fully updated.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ubuntu@ip-172-30-3-209:~$ sudo apt upgrade
  Reading package lists... Done
  Building dependency tree
  Reading state information... Done
  Calculating upgrade... Done
  0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.
</code></pre></div></div>

<ul>
  <li>
    <p>Ignore the following if you don’t understand it: typically I will explicitly update held-back packages and autoremove, until I see nothing left to update.</p>
  </li>
  <li>
    <p>Next, download the Anaconda installer: Go to the <a href="https://www.anaconda.com/download/#linux">install page</a> , right-click on the big button for the latest 3.x version and copy the link address. (IMPORTANT: make sure you download the Linux 64-bit version, not MacOS or Windows. The Anaconda website may try to auto-detect your browser platform and send you there.)</p>
  </li>
  <li>
    <p>Go back to the terminal and enter</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget &lt;<span class="nb">paste </span>url&gt;
bash ./A&lt;tab to <span class="nb">complete</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>Hit enter, spaces to get through all the responses, type yes to accept all the defaults</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ubuntu@ip-172-30-3-209:~<span class="nv">$ </span>wget https://repo.anaconda.com/archive/Anaconda3-5.3.0-Linux-x86_64.sh
<span class="nt">--2018-10-20</span> 16:30:10--  https://repo.anaconda.com/archive/Anaconda3-5.3.0-Linux-x86_64.sh
Resolving repo.anaconda.com <span class="o">(</span>repo.anaconda.com<span class="o">)</span>... 104.17.111.77, 104.17.107.77, 104.17.108.77, ...
Connecting to repo.anaconda.com <span class="o">(</span>repo.anaconda.com<span class="o">)</span>|104.17.111.77|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 667822837 <span class="o">(</span>637M<span class="o">)</span> <span class="o">[</span>application/x-sh]
Saving to: ‘Anaconda3-5.3.0-Linux-x86_64.sh’

Anaconda3-5.3.0-Linux-x86_64.sh                   100%[<span class="o">============================================================================================================&gt;]</span> 636.88M  49.5MB/s    <span class="k">in </span>11s

2018-10-20 16:30:21 <span class="o">(</span>60.2 MB/s<span class="o">)</span> - ‘Anaconda3-5.3.0-Linux-x86_64.sh’ saved <span class="o">[</span>667822837/667822837]

ubuntu@ip-172-30-3-209:~<span class="nv">$ </span>bash ./Anaconda3-5.3.0-Linux-x86_64.sh

Welcome to Anaconda3 5.3.0

In order to <span class="k">continue </span>the installation process, please review the license
agreement.
Please, press ENTER to <span class="k">continue</span>
</code></pre></div></div>

<p>IMPORTANT - when prompted, update .bashrc</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Do you wish the installer to initialize Anaconda3
<span class="k">in </span>your /home/ubuntu/.bashrc ? <span class="o">[</span><span class="nb">yes</span>|no][no] <span class="o">&gt;&gt;&gt;</span> <span class="nb">yes

</span>Initializing Anaconda3 <span class="k">in</span> /home/ubuntu/.bashrc
A backup will be made to: /home/ubuntu/.bashrc-anaconda3.bak

For this change to become active, you have to open a new terminal.

Thank you <span class="k">for </span>installing Anaconda3!

Do you wish to proceed with the installation of Microsoft VSCode? <span class="o">[</span><span class="nb">yes</span>|no]
no
</code></pre></div></div>
<ul>
  <li>Installation finished!</li>
  <li>IMPORTANT: RESTART SSH SESSION (as it helpfully points out, so .bashrc path updates take effect.)</li>
  <li>ctrl-D to exit terminal</li>
  <li>up-arrow to repeat last ssh command</li>
</ul>

<pre><code class="language-{bash}">ubuntu@ip-172-30-3-209:~$ logout
Connection to 18.234.158.61 closed.
MacBook-Pro-8:~ druce$ ssh -i AWS.pem ubuntu@18.234.158.61
</code></pre>

<ul>
  <li>run python, you should see 3.x, Anaconda build (not Ubuntu stock python)</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ubuntu@ip-172-30-3-209:~<span class="nv">$ </span>python
Python 3.7.0 <span class="o">(</span>default, Jun 28 2018, 13:15:42<span class="o">)</span>
<span class="o">[</span>GCC 7.2.0] :: Anaconda, Inc. on linux
Type <span class="s2">"help"</span>, <span class="s2">"copyright"</span>, <span class="s2">"credits"</span> or <span class="s2">"license"</span> <span class="k">for </span>more information.
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<ul>
  <li>Ctrl-D to exit Python</li>
</ul>

<p>Almost there! Let’s update Anaconda</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ubuntu@ip-172-30-3-209:~<span class="nv">$ </span>conda update <span class="nt">--all</span>
Solving environment: <span class="se">\</span>
</code></pre></div></div>

<ul>
  <li>Many updates later
    <pre><code class="language-{bash}">bleach-3.0.2         | 219 KB    | ############################################################################################################################################################ | 100%
Preparing transaction: done
Verifying transaction: done
Executing transaction: done
(base) ubuntu@ip-172-30-3-209:~$
</code></pre>
  </li>
  <li>Now you have a running Amazon instance, updated, with Anaconda installed and updated.</li>
</ul>

<h1 id="4-configure-and-run-jupyter">4) Configure and run Jupyter</h1>

<ul>
  <li>Final task is to set up and run Jupyter</li>
  <li>Create a certificate to enable https
    <ul>
      <li>Create a certs directory.</li>
      <li>cd to it.</li>
      <li>openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout mycert.pem -out mycert.pem</li>
      <li>I just hit enter for all the values requested</li>
    </ul>
  </li>
</ul>

<pre><code class="language-{bash}">(base) ubuntu@ip-172-30-3-209:~/.jupyter$ cd
(base) ubuntu@ip-172-30-3-209:~$ mkdir certs
(base) ubuntu@ip-172-30-3-209:~$ cd certs
(base) ubuntu@ip-172-30-3-209:~/certs$ openssl req -x509 -nodes -days 365 -newkey rsa:1024 -keyout mycert.pem -out mycert.pem
Generating a 1024 bit RSA private key
...++++++
....++++++

## writing new private key to 'mycert.pem'

You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,

## If you enter '.', the field will be left blank.

Country Name (2 letter code) [AU]:
State or Province Name (full name) [Some-State]:
Locality Name (eg, city) []:
Organization Name (eg, company) [Internet Widgits Pty Ltd]:
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:
Email Address []:
</code></pre>

<ul>
  <li>Create Jupyter config file and password
    <ul>
      <li>jupyter notebook –generate-config</li>
    </ul>
  </li>
  <li>Create password
    <ul>
      <li>jupyter notebook password</li>
      <li>enter password twice</li>
    </ul>
  </li>
</ul>

<pre><code class="language-{bash}">(base) ubuntu@ip-172-30-3-209:~$ jupyter notebook --generate-config
Writing default config to: /home/ubuntu/.jupyter/jupyter_notebook_config.py
(base) ubuntu@ip-172-30-3-209:~$ jupyter notebook password
Enter password:
Verify password:
[NotebookPasswordApp] Wrote hashed password to /home/ubuntu/.jupyter/jupyter_notebook_config.json
(base) ubuntu@ip-172-30-3-209:~$
</code></pre>
<ul>
  <li>In your favorite editor (vi, emacs etc.) open ~/.jupyter/jupyter_notebook_config.py. Add these entries at top. (Or search for corresponding commented-out entries, uncomment and edit appropriately.)</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>druce@jupyter1:~<span class="nv">$ </span><span class="nb">cd</span> ~/.jupyter/
druce@jupyter1:~/.jupyter<span class="nv">$ </span>emacs jupyter_notebook_config.py
</code></pre></div></div>

<pre><code class="language-{python}">
# Kernel config
c.IPKernelApp.pylab = 'inline'  # if you want plotting support always in your notebook

# Notebook config
c.NotebookApp.allow_remote_access = True
c.NotebookApp.certfile = u'/home/ubuntu/certs/mycert.pem' #location of your certificate file
c.NotebookApp.ip = '*'
c.NotebookApp.open_browser = False  #so that the jupyter notebook server does not try to open up a browser by default (no GUI or browser installed on your AWS server)
# Set the port to 8888
c.NotebookApp.port = 8888
</code></pre>
<ul>
  <li>Run Jupyter</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ubuntu@ip-172-30-1-196:~<span class="nv">$ </span>jupyter notebook
<span class="o">[</span>I 13:31:08.070 NotebookApp] Writing notebook server cookie secret to /run/user/1000/jupyter/notebook_cookie_secret
<span class="o">[</span>I 13:31:10.881 NotebookApp] JupyterLab extension loaded from /home/ubuntu/anaconda3/lib/python3.7/site-packages/jupyterlab
<span class="o">[</span>I 13:31:10.881 NotebookApp] JupyterLab application directory is /home/ubuntu/anaconda3/share/jupyter/lab
<span class="o">[</span>I 13:31:10.883 NotebookApp] Serving notebooks from <span class="nb">local </span>directory: /home/ubuntu
<span class="o">[</span>I 13:31:10.883 NotebookApp] The Jupyter Notebook is running at:
<span class="o">[</span>I 13:31:10.883 NotebookApp] https://<span class="o">(</span>ip-172-30-1-196 or 127.0.0.1<span class="o">)</span>:8888/
<span class="o">[</span>I 13:31:10.883 NotebookApp] Use Control-C to stop this server and shut down all kernels <span class="o">(</span>twice to skip confirmation<span class="o">)</span><span class="nb">.</span>

</code></pre></div></div>

<ul>
  <li>
    <p>Note where it says “The Jupyter Notebook is running at:”</p>

    <ul>
      <li>Server should be running on all IP addresses (not localhost)</li>
      <li>Port should be :8888 (If it’s e.g. 8889, other servers may be running)</li>
    </ul>
  </li>
  <li>
    <p>Go to your browser and connect to https://xxx.xxx.xxx.xxx:8888</p>

    <ul>
      <li>IMPORTANT: Use the IP from your AWS console, not the local IP reported by Jupyter startup. And make sure to use https.</li>
    </ul>
  </li>
  <li>
    <p>In Chrome, click “Advanced”, ignore the warning and proceed (if Firefox, add an exception)</p>

    <ul>
      <li>(You get a warning because the certificate domain name doesn’t match our IP address, which changes every time we launch an AWS instance)</li>
    </ul>
  </li>
</ul>

<p><img src="12.1 Chrome warning.png" alt="12.1 Chrome warning.png" /></p>

<ul>
  <li>
    <p>Enter the Jupyter password you created.
<img src="12.2 Password.png" alt="12.2 Password.png" /></p>
  </li>
  <li>
    <p>You are in business!
<img src="12.3 Success.png" alt="12.3 Success.png" />
<img src="12.3 Success2.png" alt="12.3 Success2.png" /></p>
  </li>
</ul>

<h1 id="5-final-step---make-an-image-of-your-instance-for-backup">5) Final step - Make an image of your instance for backup</h1>

<ul>
  <li>
    <p>Grab a well-earned cup of coffee, tea, or whiskey!</p>
  </li>
  <li>
    <p>One last thing is to create an image of your server. Otherwise you have to do ALL THESE STEPS again to launch another server.</p>
  </li>
  <li>
    <p>Also, remember all the benefits of AWS? They all involve images:</p>

    <ul>
      <li>Scale up: Image and launch new instance from same image on a bigger instance type, or larger disk.</li>
      <li>Scale out: Image and launch many instances from same image at same time.</li>
      <li>Access resources: Image and launch a new instance on e.g. a GPU instance type</li>
    </ul>
  </li>
  <li>
    <p>To make an image of your instance, log into the console <a href="https://console.aws.amazon.com/ec2/v2/#Instances">https://console.aws.amazon.com/ec2/v2/#Instances</a></p>
  </li>
  <li>
    <p>Right-click on your instance, choose Image, Create Image
<img src="13.1 CreateImage1.png" alt="13.1 CreateImage1.png" /></p>
  </li>
  <li>
    <p>Give the image a good name, I’ll usually go with desc-date. I didn’t bother with a good description, but you might put ‘Fresh working Jupyter on Ubuntu 18.04, with all updates’
<img src="13.2 CreateImage2.png" alt="13.2 CreateImage2.png" /></p>

    <ul>
      <li>Note: this is where you adjust your disk size if you want to increase it (for bigger instances/jobs) or reduce it (save storage space)</li>
    </ul>
  </li>
  <li>
    <p>Click ‘Create image’</p>

    <ul>
      <li>Note: this will restart your instance</li>
    </ul>
  </li>
  <li>
    <p>Creating the image can take 10 mins - go to the AMIs tab and see when it’s available.</p>
  </li>
  <li>
    <p>While your image is being created, your running server will restart and you can reconnect after it finishes booting in a couple of minutes. You can SSH to it using same IP as before.</p>
  </li>
  <li>
    <p>When your AMI says ‘available’ in the EC2 “AMIs” tab, right-click on image, click Launch instance
<img src="Launch1.png" alt="Launch1.png" /></p>
  </li>
  <li>
    <p>Choose instance type (e.g. t2.micro)</p>
  </li>
  <li>
    <p>Hit next until you get to “Configure Security Group”</p>
  </li>
  <li>
    <p>Set the security group you created earlier, e.g. “Jupyter”</p>
  </li>
  <li>
    <p>Click “Review and Launch”</p>
  </li>
  <li>
    <p>Click “Launch”</p>
  </li>
  <li>
    <p>You will be prompted for the key pair: Select the one you created earlier, e.g. “AWS”, check the confirmation box, click “Launch Instances”
<img src="keypair2.png" alt="keypair2.png" /></p>
  </li>
  <li>
    <p>Go to your instances in the AWS console, wait a couple of minutes, hit refresh to get the new instance’s IP</p>
  </li>
  <li>
    <p>You can now SSH to the new IP just like the old one.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MacBook-Pro-10:~ druce<span class="nv">$ </span>ssh <span class="nt">-i</span> AWS.pem ubuntu@54.237.195.0
The authenticity of host <span class="s1">'54.237.195.0 (54.237.195.0)'</span> can<span class="s1">'t be established.
ECDSA key fingerprint is SHA256:0KCT3Xk/i2tlabHzKQOTYS/joKSL+j0EZ45d/bNwKEc.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '</span>54.237.195.0<span class="s1">' (ECDSA) to the list of known hosts.
Welcome to Ubuntu 18.04.1 LTS (GNU/Linux 4.15.0-1023-aws x86_64)
 
</span></code></pre></div></div>

<ul>
  <li>
    <p>You now have 2 identical running instances.</p>
  </li>
  <li>
    <p>To terminate your instances, go to the instances in your console, right-click, choose “Instance State” and choose “Terminate”.</p>

    <p><img src="14. Terminate.png" alt="14. Terminate.png" />
WARNING: if you have work to save, IMAGE your instance before terminating it.
When you terminate the instance, everything on it is deleted, so you will lose everything you did since the last image.</p>
  </li>
  <li>
    <p>If you aren’t going to use your instance for a while, stop it, and if you have made a lot of changes, image it to have a backup. When you have a lot of images, you may want to clean them up by ‘Deregistering’ the AMIs and deleting their ‘Snapshots’. But by then you will be an AWS expert!</p>
  </li>
</ul>

<h1 id="6-final-final-step---set-jupyter-to-run-automatically-at-startup">6) Final final step - Set Jupyter to run automatically at startup.</h1>

<p>OK, I lied. There is one final step I recommend, which is to run Jupyter at startup.</p>

<p>So you have Jupyter running exactly the way you want in a terminal. You create an amazing notebook that will train overnight. You smile, disconnect your laptop, go home, and come back the next day … to find that as soon as you disconnected, Ubuntu helpfully killed all the jobs running in the session, including the Jupyter server.</p>

<p>To avoid this misadventure, create a runjupyter.sh that looks something like the one below.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># run at startup from etc/rc.local</span>

<span class="c"># added by Anaconda3 installer</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"/home/ubuntu/anaconda3/bin:</span><span class="nv">$PATH</span><span class="s2">"</span>

<span class="c"># added for cuda/tensorflow</span>
<span class="nb">export </span><span class="nv">CUDA_HOME</span><span class="o">=</span>/usr/local/cuda
<span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="k">${</span><span class="nv">CUDA_HOME</span><span class="k">}</span>/lib64:<span class="nv">$LD_LIBRARY_PATH</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="k">${</span><span class="nv">CUDA_HOME</span><span class="k">}</span>/bin:<span class="k">${</span><span class="nv">PATH</span><span class="k">}</span>

<span class="c"># activate the proper virtualenv</span>
<span class="nb">source </span>activate jupyter

<span class="c"># cd to the proper directory</span>
<span class="nb">cd</span> /home/ubuntu/Notebooks

<span class="c"># run jupyter in the background</span>
jupyter notebook &amp;
</code></pre></div></div>
<p>It should include all anaconda and related environment variables and paths from your .bashrc file. Then it should activate the proper virtualenv, cd to the proper directory, and run Jupyter in the background. (You can safely ignore the virtualenv and CUDA/Tensorflow stuff if you don’t use them, just use the Anadonda-related environment variables and paths from your .bashrc.)</p>

<p>Then do</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod </span>755 /home/ubuntu/runjupyter.sh
<span class="nb">sudo </span>vi /etc/rc.local
</code></pre></div></div>

<p>and add this at the bottom of the file</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/su ubuntu <span class="nt">-c</span>  <span class="s2">"home/ubuntu/runjupyter.sh"</span>
</code></pre></div></div>

<p>Now, whenever I launch this instance, it automatically starts Jupyter running under my account, and I don’t even have to ssh into the server. And I don’t have to worry about something killing the Jupyter server which is running in the terminal.</p>

<p>Or search for “run jupyter at startup” and use one of the other methods. This one may be crude, but it works.</p>

<p>Enjoy awesome data science on AWS with Jupyter!</p>

<p>See also and bookmark</p>

<ul>
  <li><a href="https://jupyter.readthedocs.io/en/latest/">Jupyter Docs</a></li>
  <li><a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/concepts.html">Amazon EC2 Docs</a></li>
  <li><a href="https://towardsdatascience.com/running-jupyter-notebook-in-google-cloud-platform-in-15-min-61e16da34d52">Run Jupyter on Google Cloud</a></li>
</ul>

